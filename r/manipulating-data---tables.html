<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Manipulating Data - Tables | Apache Arrow R Cookbook</title>
  <meta name="description" content="6 Manipulating Data - Tables | Apache Arrow R Cookbook" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Manipulating Data - Tables | Apache Arrow R Cookbook" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Manipulating Data - Tables | Apache Arrow R Cookbook" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="manipulating-data---arrays.html"/>
<link rel="next" href="using-pyarrow-from-r.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface<span></span></a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#what-is-arrow"><i class="fa fa-check"></i><b>1.1</b> What is Arrow?<span></span></a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#alternative-resources"><i class="fa fa-check"></i><b>1.2</b> Alternative resources<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html"><i class="fa fa-check"></i><b>2</b> Reading and Writing Data<span></span></a><ul>
<li class="chapter" data-level="2.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#convert-from-a-data-frame-to-an-arrow-table"><i class="fa fa-check"></i><b>2.2</b> Convert from a data frame to an Arrow Table<span></span></a><ul>
<li class="chapter" data-level="2.2.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution"><i class="fa fa-check"></i><b>2.2.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#convert-data-from-an-arrow-table-to-a-data-frame"><i class="fa fa-check"></i><b>2.3</b> Convert data from an Arrow Table to a data frame<span></span></a><ul>
<li class="chapter" data-level="2.3.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-1"><i class="fa fa-check"></i><b>2.3.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="2.3.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#discussion"><i class="fa fa-check"></i><b>2.3.2</b> Discussion<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#write-a-parquet-file"><i class="fa fa-check"></i><b>2.4</b> Write a Parquet file<span></span></a><ul>
<li class="chapter" data-level="2.4.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-2"><i class="fa fa-check"></i><b>2.4.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#read-a-parquet-file"><i class="fa fa-check"></i><b>2.5</b> Read a Parquet file<span></span></a><ul>
<li class="chapter" data-level="2.5.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-3"><i class="fa fa-check"></i><b>2.5.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="2.5.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#discussion-1"><i class="fa fa-check"></i><b>2.5.2</b> Discussion<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#read-a-parquet-file-from-s3"><i class="fa fa-check"></i><b>2.6</b> Read a Parquet file from S3<span></span></a><ul>
<li class="chapter" data-level="2.6.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-4"><i class="fa fa-check"></i><b>2.6.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="2.6.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#see-also"><i class="fa fa-check"></i><b>2.6.2</b> See also<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#filter-columns-while-reading-a-parquet-file"><i class="fa fa-check"></i><b>2.7</b> Filter columns while reading a Parquet file<span></span></a><ul>
<li class="chapter" data-level="2.7.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-5"><i class="fa fa-check"></i><b>2.7.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#write-an-ipcfeather-v2-file"><i class="fa fa-check"></i><b>2.8</b> Write an IPC/Feather V2 file<span></span></a><ul>
<li class="chapter" data-level="2.8.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-6"><i class="fa fa-check"></i><b>2.8.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="2.8.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#discussion-2"><i class="fa fa-check"></i><b>2.8.2</b> Discussion<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#read-a-feather-file"><i class="fa fa-check"></i><b>2.9</b> Read a Feather file<span></span></a><ul>
<li class="chapter" data-level="2.9.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-7"><i class="fa fa-check"></i><b>2.9.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#write-streaming-ipc-files"><i class="fa fa-check"></i><b>2.10</b> Write streaming IPC files<span></span></a><ul>
<li class="chapter" data-level="2.10.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-8"><i class="fa fa-check"></i><b>2.10.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#read-streaming-ipc-files"><i class="fa fa-check"></i><b>2.11</b> Read streaming IPC files<span></span></a><ul>
<li class="chapter" data-level="2.11.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-9"><i class="fa fa-check"></i><b>2.11.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.12" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#read-csv-files"><i class="fa fa-check"></i><b>2.12</b> Read CSV files<span></span></a><ul>
<li class="chapter" data-level="2.12.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-10"><i class="fa fa-check"></i><b>2.12.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.13" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#write-csv-files"><i class="fa fa-check"></i><b>2.13</b> Write CSV files<span></span></a><ul>
<li class="chapter" data-level="2.13.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-11"><i class="fa fa-check"></i><b>2.13.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.14" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#read-json-files"><i class="fa fa-check"></i><b>2.14</b> Read JSON files<span></span></a><ul>
<li class="chapter" data-level="2.14.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-12"><i class="fa fa-check"></i><b>2.14.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.15" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#write-partitioned-data"><i class="fa fa-check"></i><b>2.15</b> Write partitioned data<span></span></a><ul>
<li class="chapter" data-level="2.15.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-13"><i class="fa fa-check"></i><b>2.15.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.16" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#read-partitioned-data"><i class="fa fa-check"></i><b>2.16</b> Read partitioned data<span></span></a><ul>
<li class="chapter" data-level="2.16.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-14"><i class="fa fa-check"></i><b>2.16.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.17" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#write-compressed-data"><i class="fa fa-check"></i><b>2.17</b> Write compressed data<span></span></a><ul>
<li class="chapter" data-level="2.17.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-15"><i class="fa fa-check"></i><b>2.17.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="2.17.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#discussion-3"><i class="fa fa-check"></i><b>2.17.2</b> Discussion<span></span></a></li>
<li class="chapter" data-level="2.17.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#see-also-1"><i class="fa fa-check"></i><b>2.17.3</b> See also<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.18" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#read-compressed-data"><i class="fa fa-check"></i><b>2.18</b> Read compressed data<span></span></a><ul>
<li class="chapter" data-level="2.18.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#solution-16"><i class="fa fa-check"></i><b>2.18.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="2.18.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#discussion-4"><i class="fa fa-check"></i><b>2.18.2</b> Discussion<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="creating-arrow-objects.html"><a href="creating-arrow-objects.html"><i class="fa fa-check"></i><b>3</b> Creating Arrow Objects<span></span></a><ul>
<li class="chapter" data-level="3.1" data-path="creating-arrow-objects.html"><a href="creating-arrow-objects.html#create-an-arrow-array-from-an-r-object"><i class="fa fa-check"></i><b>3.1</b> Create an Arrow Array from an R object<span></span></a><ul>
<li class="chapter" data-level="3.1.1" data-path="creating-arrow-objects.html"><a href="creating-arrow-objects.html#solution-17"><i class="fa fa-check"></i><b>3.1.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="creating-arrow-objects.html"><a href="creating-arrow-objects.html#create-a-arrow-table-from-an-r-object"><i class="fa fa-check"></i><b>3.2</b> Create a Arrow Table from an R object<span></span></a><ul>
<li class="chapter" data-level="3.2.1" data-path="creating-arrow-objects.html"><a href="creating-arrow-objects.html#solution-18"><i class="fa fa-check"></i><b>3.2.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="creating-arrow-objects.html"><a href="creating-arrow-objects.html#view-the-contents-of-an-arrow-table-or-recordbatch"><i class="fa fa-check"></i><b>3.3</b> View the contents of an Arrow Table or RecordBatch<span></span></a><ul>
<li class="chapter" data-level="3.3.1" data-path="creating-arrow-objects.html"><a href="creating-arrow-objects.html#solution-19"><i class="fa fa-check"></i><b>3.3.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="creating-arrow-objects.html"><a href="creating-arrow-objects.html#manually-create-a-recordbatch-from-an-r-object."><i class="fa fa-check"></i><b>3.4</b> Manually create a RecordBatch from an R object.<span></span></a><ul>
<li class="chapter" data-level="3.4.1" data-path="creating-arrow-objects.html"><a href="creating-arrow-objects.html#solution-20"><i class="fa fa-check"></i><b>3.4.1</b> Solution<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="defining-data-types.html"><a href="defining-data-types.html"><i class="fa fa-check"></i><b>4</b> Defining Data Types<span></span></a><ul>
<li class="chapter" data-level="4.1" data-path="defining-data-types.html"><a href="defining-data-types.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="defining-data-types.html"><a href="defining-data-types.html#update-data-type-of-an-existing-arrow-array"><i class="fa fa-check"></i><b>4.2</b> Update data type of an existing Arrow Array<span></span></a><ul>
<li class="chapter" data-level="4.2.1" data-path="defining-data-types.html"><a href="defining-data-types.html#solution-21"><i class="fa fa-check"></i><b>4.2.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="4.2.2" data-path="defining-data-types.html"><a href="defining-data-types.html#discussion-5"><i class="fa fa-check"></i><b>4.2.2</b> Discussion<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="defining-data-types.html"><a href="defining-data-types.html#update-data-type-of-a-field-in-an-existing-arrow-table"><i class="fa fa-check"></i><b>4.3</b> Update data type of a field in an existing Arrow Table<span></span></a><ul>
<li class="chapter" data-level="4.3.1" data-path="defining-data-types.html"><a href="defining-data-types.html#solution-22"><i class="fa fa-check"></i><b>4.3.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="4.3.2" data-path="defining-data-types.html"><a href="defining-data-types.html#no-compat-type"><i class="fa fa-check"></i><b>4.3.2</b> Discussion<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="defining-data-types.html"><a href="defining-data-types.html#specify-data-types-when-creating-an-arrow-table-from-an-r-object"><i class="fa fa-check"></i><b>4.4</b> Specify data types when creating an Arrow table from an R object<span></span></a><ul>
<li class="chapter" data-level="4.4.1" data-path="defining-data-types.html"><a href="defining-data-types.html#solution-23"><i class="fa fa-check"></i><b>4.4.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="defining-data-types.html"><a href="defining-data-types.html#specify-data-types-when-reading-in-files"><i class="fa fa-check"></i><b>4.5</b> Specify data types when reading in files<span></span></a><ul>
<li class="chapter" data-level="4.5.1" data-path="defining-data-types.html"><a href="defining-data-types.html#solution-24"><i class="fa fa-check"></i><b>4.5.1</b> Solution<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html"><i class="fa fa-check"></i><b>5</b> Manipulating Data - Arrays<span></span></a><ul>
<li class="chapter" data-level="5.1" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#filter-by-values-matching-a-predicate-or-mask"><i class="fa fa-check"></i><b>5.2</b> Filter by values matching a predicate or mask<span></span></a><ul>
<li class="chapter" data-level="5.2.1" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#solution-25"><i class="fa fa-check"></i><b>5.2.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="5.2.2" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#discussion-6"><i class="fa fa-check"></i><b>5.2.2</b> Discussion<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#compute-meanminmax-etc-value-of-an-array"><i class="fa fa-check"></i><b>5.3</b> Compute Mean/Min/Max, etc value of an Array<span></span></a><ul>
<li class="chapter" data-level="5.3.1" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#solution-26"><i class="fa fa-check"></i><b>5.3.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="5.3.2" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#discussion-7"><i class="fa fa-check"></i><b>5.3.2</b> Discussion<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#count-occurrences-of-elements-in-an-array"><i class="fa fa-check"></i><b>5.4</b> Count occurrences of elements in an Array<span></span></a><ul>
<li class="chapter" data-level="5.4.1" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#solution-27"><i class="fa fa-check"></i><b>5.4.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="5.4.2" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#discussion-8"><i class="fa fa-check"></i><b>5.4.2</b> Discussion<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#apply-arithmetic-functions-to-arrays."><i class="fa fa-check"></i><b>5.5</b> Apply arithmetic functions to Arrays.<span></span></a><ul>
<li class="chapter" data-level="5.5.1" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#solution-28"><i class="fa fa-check"></i><b>5.5.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="5.5.2" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#discussion-9"><i class="fa fa-check"></i><b>5.5.2</b> Discussion<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#call-arrow-compute-functions-directly-on-arrays"><i class="fa fa-check"></i><b>5.6</b> Call Arrow compute functions directly on Arrays<span></span></a><ul>
<li class="chapter" data-level="5.6.1" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#solution-29"><i class="fa fa-check"></i><b>5.6.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="5.6.2" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#discussion-10"><i class="fa fa-check"></i><b>5.6.2</b> Discussion<span></span></a></li>
<li class="chapter" data-level="5.6.3" data-path="manipulating-data---arrays.html"><a href="manipulating-data---arrays.html#see-also-2"><i class="fa fa-check"></i><b>5.6.3</b> See also<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="manipulating-data---tables.html"><a href="manipulating-data---tables.html"><i class="fa fa-check"></i><b>6</b> Manipulating Data - Tables<span></span></a><ul>
<li class="chapter" data-level="6.1" data-path="manipulating-data---tables.html"><a href="manipulating-data---tables.html#introduction-3"><i class="fa fa-check"></i><b>6.1</b> Introduction<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="manipulating-data---tables.html"><a href="manipulating-data---tables.html#use-dplyr-verbs-in-arrow"><i class="fa fa-check"></i><b>6.2</b> Use dplyr verbs in arrow<span></span></a><ul>
<li class="chapter" data-level="6.2.1" data-path="manipulating-data---tables.html"><a href="manipulating-data---tables.html#solution-30"><i class="fa fa-check"></i><b>6.2.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="6.2.2" data-path="manipulating-data---tables.html"><a href="manipulating-data---tables.html#discussion-11"><i class="fa fa-check"></i><b>6.2.2</b> Discussion<span></span></a></li>
<li class="chapter" data-level="6.2.3" data-path="manipulating-data---tables.html"><a href="manipulating-data---tables.html#see-also-3"><i class="fa fa-check"></i><b>6.2.3</b> See also<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="manipulating-data---tables.html"><a href="manipulating-data---tables.html#use-r-functions-in-dplyr-verbs-in-arrow"><i class="fa fa-check"></i><b>6.3</b> Use R functions in dplyr verbs in arrow<span></span></a><ul>
<li class="chapter" data-level="6.3.1" data-path="manipulating-data---tables.html"><a href="manipulating-data---tables.html#solution-31"><i class="fa fa-check"></i><b>6.3.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="6.3.2" data-path="manipulating-data---tables.html"><a href="manipulating-data---tables.html#discussion-12"><i class="fa fa-check"></i><b>6.3.2</b> Discussion<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="manipulating-data---tables.html"><a href="manipulating-data---tables.html#use-arrow-functions-in-dplyr-verbs-in-arrow"><i class="fa fa-check"></i><b>6.4</b> Use arrow functions in dplyr verbs in arrow<span></span></a><ul>
<li class="chapter" data-level="6.4.1" data-path="manipulating-data---tables.html"><a href="manipulating-data---tables.html#solution-32"><i class="fa fa-check"></i><b>6.4.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="6.4.2" data-path="manipulating-data---tables.html"><a href="manipulating-data---tables.html#discussion-13"><i class="fa fa-check"></i><b>6.4.2</b> Discussion<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="using-pyarrow-from-r.html"><a href="using-pyarrow-from-r.html"><i class="fa fa-check"></i><b>7</b> Using PyArrow from R<span></span></a><ul>
<li class="chapter" data-level="7.1" data-path="using-pyarrow-from-r.html"><a href="using-pyarrow-from-r.html#introduction-4"><i class="fa fa-check"></i><b>7.1</b> Introduction<span></span></a></li>
<li class="chapter" data-level="7.2" data-path="using-pyarrow-from-r.html"><a href="using-pyarrow-from-r.html#create-an-arrow-object-using-pyarrow-in-r"><i class="fa fa-check"></i><b>7.2</b> Create an Arrow object using PyArrow in R<span></span></a><ul>
<li class="chapter" data-level="7.2.1" data-path="using-pyarrow-from-r.html"><a href="using-pyarrow-from-r.html#solution-33"><i class="fa fa-check"></i><b>7.2.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="using-pyarrow-from-r.html"><a href="using-pyarrow-from-r.html#call-a-pyarrow-function-from-r"><i class="fa fa-check"></i><b>7.3</b> Call a PyArrow function from R<span></span></a><ul>
<li class="chapter" data-level="7.3.1" data-path="using-pyarrow-from-r.html"><a href="using-pyarrow-from-r.html#solution-34"><i class="fa fa-check"></i><b>7.3.1</b> Solution<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="flight.html"><a href="flight.html"><i class="fa fa-check"></i><b>8</b> Flight<span></span></a><ul>
<li class="chapter" data-level="8.1" data-path="flight.html"><a href="flight.html#introduction-5"><i class="fa fa-check"></i><b>8.1</b> Introduction<span></span></a></li>
<li class="chapter" data-level="8.2" data-path="flight.html"><a href="flight.html#connect-to-a-flight-server"><i class="fa fa-check"></i><b>8.2</b> Connect to a Flight server<span></span></a><ul>
<li class="chapter" data-level="8.2.1" data-path="flight.html"><a href="flight.html#solution-35"><i class="fa fa-check"></i><b>8.2.1</b> Solution<span></span></a></li>
<li class="chapter" data-level="8.2.2" data-path="flight.html"><a href="flight.html#see-also-4"><i class="fa fa-check"></i><b>8.2.2</b> See also<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="flight.html"><a href="flight.html#send-data-to-a-flight-server"><i class="fa fa-check"></i><b>8.3</b> Send data to a Flight server<span></span></a><ul>
<li class="chapter" data-level="8.3.1" data-path="flight.html"><a href="flight.html#solution-36"><i class="fa fa-check"></i><b>8.3.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="flight.html"><a href="flight.html#check-what-resources-exist-on-a-flight-server"><i class="fa fa-check"></i><b>8.4</b> Check what resources exist on a Flight server<span></span></a><ul>
<li class="chapter" data-level="8.4.1" data-path="flight.html"><a href="flight.html#solution-37"><i class="fa fa-check"></i><b>8.4.1</b> Solution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="flight.html"><a href="flight.html#retrieve-data-from-a-flight-server"><i class="fa fa-check"></i><b>8.5</b> Retrieve data from a Flight server<span></span></a><ul>
<li class="chapter" data-level="8.5.1" data-path="flight.html"><a href="flight.html#solution-38"><i class="fa fa-check"></i><b>8.5.1</b> Solution<span></span></a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Apache Arrow R Cookbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="manipulating-data---tables" class="section level1 hasAnchor">
<h1><span class="header-section-number">6</span> Manipulating Data - Tables<a href="manipulating-data---tables.html#manipulating-data---tables" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-3" class="section level2 hasAnchor">
<h2><span class="header-section-number">6.1</span> Introduction<a href="manipulating-data---tables.html#introduction-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One of the aims of the Arrow project is to reduce duplication between different
data frame implementations. The underlying implementation of a data frame is a
conceptually different thing to the code that you run to work with it - the API.</p>
<p>You may have seen this before in packages like <code>dbplyr</code> which allow you to use
the dplyr API to interact with SQL databases.</p>
<p>The <code>arrow</code> package has been written so that the underlying Arrow table-like
objects can be manipulated via use of the dplyr API via the dplyr verbs.</p>
<p>For example, here’s a short pipeline of data manipulation which uses dplyr exclusively:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="manipulating-data---tables.html#cb83-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb83-2"><a href="manipulating-data---tables.html#cb83-2"></a>starwars <span class="op">%&gt;%</span></span>
<span id="cb83-3"><a href="manipulating-data---tables.html#cb83-3"></a><span class="st">  </span><span class="kw">filter</span>(species <span class="op">==</span><span class="st"> &quot;Human&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb83-4"><a href="manipulating-data---tables.html#cb83-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">height_ft =</span> height<span class="op">/</span><span class="fl">30.48</span>) <span class="op">%&gt;%</span></span>
<span id="cb83-5"><a href="manipulating-data---tables.html#cb83-5"></a><span class="st">  </span><span class="kw">select</span>(name, height_ft)</span></code></pre></div>
<pre><code>## # A tibble: 35 × 2
##    name               height_ft
##    &lt;chr&gt;                  &lt;dbl&gt;
##  1 Luke Skywalker          5.64
##  2 Darth Vader             6.63
##  3 Leia Organa             4.92
##  4 Owen Lars               5.84
##  5 Beru Whitesun lars      5.41
##  6 Biggs Darklighter       6.00
##  7 Obi-Wan Kenobi          5.97
##  8 Anakin Skywalker        6.17
##  9 Wilhuff Tarkin          5.91
## 10 Han Solo                5.91
## # … with 25 more rows</code></pre>
<p>And the same results as using arrow with dplyr syntax:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="manipulating-data---tables.html#cb85-1"></a><span class="kw">arrow_table</span>(starwars) <span class="op">%&gt;%</span></span>
<span id="cb85-2"><a href="manipulating-data---tables.html#cb85-2"></a><span class="st">  </span><span class="kw">filter</span>(species <span class="op">==</span><span class="st"> &quot;Human&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb85-3"><a href="manipulating-data---tables.html#cb85-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">height_ft =</span> height<span class="op">/</span><span class="fl">30.48</span>) <span class="op">%&gt;%</span></span>
<span id="cb85-4"><a href="manipulating-data---tables.html#cb85-4"></a><span class="st">  </span><span class="kw">select</span>(name, height_ft) <span class="op">%&gt;%</span></span>
<span id="cb85-5"><a href="manipulating-data---tables.html#cb85-5"></a><span class="st">  </span><span class="kw">collect</span>()</span></code></pre></div>
<pre><code>## # A tibble: 35 × 2
##    name               height_ft
##    &lt;chr&gt;                  &lt;dbl&gt;
##  1 Luke Skywalker          5.64
##  2 Darth Vader             6.63
##  3 Leia Organa             4.92
##  4 Owen Lars               5.84
##  5 Beru Whitesun lars      5.41
##  6 Biggs Darklighter       6.00
##  7 Obi-Wan Kenobi          5.97
##  8 Anakin Skywalker        6.17
##  9 Wilhuff Tarkin          5.91
## 10 Han Solo                5.91
## # … with 25 more rows</code></pre>
<p>You’ll notice we’ve used <code>collect()</code> in the Arrow pipeline above. That’s because
one of the ways in which <code>arrow</code> is efficient is that it works out the instructions
for the calculations it needs to perform (<em>expressions</em>) and only runs them
using arrow once you actually pull the data into your R session. This means
instead of doing lots of separate operations, it does them all at once in a
more optimised way, <em>lazy evaluation</em>.</p>
<p>It also means that you are able to manipulate data that is larger than you can
fit into memory on the machine you’re running your code on, if you only pull
data into R when you have selected the desired subset, or when using functions
which can operate on chunks of data.</p>
<p>You can also have data which is split across multiple files. For example, you
might have files which are stored in multiple Parquet or Feather files,
partitioned across different directories. You can open multi-file datasets
using <code>open_dataset()</code> as discussed in a previous chapter, and then manipulate
this data using arrow before even reading any of it into R.</p>
</div>
<div id="use-dplyr-verbs-in-arrow" class="section level2 hasAnchor">
<h2><span class="header-section-number">6.2</span> Use dplyr verbs in arrow<a href="manipulating-data---tables.html#use-dplyr-verbs-in-arrow" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You want to use a dplyr verb in arrow.</p>
<div id="solution-30" class="section level3 hasAnchor">
<h3><span class="header-section-number">6.2.1</span> Solution<a href="manipulating-data---tables.html#solution-30" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="manipulating-data---tables.html#cb87-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb87-2"><a href="manipulating-data---tables.html#cb87-2"></a><span class="kw">arrow_table</span>(starwars) <span class="op">%&gt;%</span></span>
<span id="cb87-3"><a href="manipulating-data---tables.html#cb87-3"></a><span class="st">  </span><span class="kw">filter</span>(species <span class="op">==</span><span class="st"> &quot;Human&quot;</span>, homeworld <span class="op">==</span><span class="st"> &quot;Tatooine&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb87-4"><a href="manipulating-data---tables.html#cb87-4"></a><span class="st">  </span><span class="kw">collect</span>()</span></code></pre></div>
<pre><code>## # A tibble: 8 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Luke Sky…    172    77 blond      fair       blue            19   male  mascu…
## 2 Darth Va…    202   136 none       white      yellow          41.9 male  mascu…
## 3 Owen Lars    178   120 brown, gr… light      blue            52   male  mascu…
## 4 Beru Whi…    165    75 brown      light      blue            47   fema… femin…
## 5 Biggs Da…    183    84 black      light      brown           24   male  mascu…
## 6 Anakin S…    188    84 blond      fair       blue            41.9 male  mascu…
## 7 Shmi Sky…    163    NA black      fair       brown           72   fema… femin…
## 8 Cliegg L…    183    NA brown      fair       blue            82   male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&lt;character&gt;&gt;, vehicles &lt;list&lt;character&gt;&gt;,
## #   starships &lt;list&lt;character&gt;&gt;</code></pre>
</div>
<div id="discussion-11" class="section level3 hasAnchor">
<h3><span class="header-section-number">6.2.2</span> Discussion<a href="manipulating-data---tables.html#discussion-11" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can use most of the dplyr verbs directly from arrow.</p>
</div>
<div id="see-also-3" class="section level3 hasAnchor">
<h3><span class="header-section-number">6.2.3</span> See also<a href="manipulating-data---tables.html#see-also-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can find examples of the various dplyr verbs in “Introduction to dplyr” -
run <code>vignette("dplyr", package = "dplyr")</code> or view on
the <a href="https://dplyr.tidyverse.org/articles/dplyr.html">pkgdown site</a>.</p>
<p>You can see more information about using <code>arrow_table()</code> to create Arrow Tables
and <code>collect()</code> to view them as R data frames in <a href="creating-arrow-objects.html#creating-arrow-objects">Creating Arrow Objects</a>.</p>
</div>
</div>
<div id="use-r-functions-in-dplyr-verbs-in-arrow" class="section level2 hasAnchor">
<h2><span class="header-section-number">6.3</span> Use R functions in dplyr verbs in arrow<a href="manipulating-data---tables.html#use-r-functions-in-dplyr-verbs-in-arrow" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You want to use an R function inside a dplyr verb in arrow.</p>
<div id="solution-31" class="section level3 hasAnchor">
<h3><span class="header-section-number">6.3.1</span> Solution<a href="manipulating-data---tables.html#solution-31" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="manipulating-data---tables.html#cb89-1"></a><span class="kw">arrow_table</span>(starwars) <span class="op">%&gt;%</span></span>
<span id="cb89-2"><a href="manipulating-data---tables.html#cb89-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(name, <span class="st">&quot;Darth&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb89-3"><a href="manipulating-data---tables.html#cb89-3"></a><span class="st">  </span><span class="kw">collect</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Darth Va…    202   136 none       white      yellow          41.9 male  mascu…
## 2 Darth Ma…    175    80 none       red        yellow          54   male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&lt;character&gt;&gt;, vehicles &lt;list&lt;character&gt;&gt;,
## #   starships &lt;list&lt;character&gt;&gt;</code></pre>
</div>
<div id="discussion-12" class="section level3 hasAnchor">
<h3><span class="header-section-number">6.3.2</span> Discussion<a href="manipulating-data---tables.html#discussion-12" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The arrow package allows you to use dplyr verbs containing expressions which
include base R and many tidyverse functions, but call Arrow functions under the hood.
If you find any base R or tidyverse functions which you would like to see a
mapping of in arrow, please
<a href="https://issues.apache.org/jira/projects/ARROW/issues">open an issue on the project JIRA</a>.</p>
<p>The following packages (amongst some from others) have had many function
bindings/mappings written in arrow:</p>
<ul>
<li><a href="https://lubridate.tidyverse.org/">lubridate</a></li>
<li><a href="https://stringr.tidyverse.org/">stringr</a></li>
<li><a href="https://dplyr.tidyverse.org/">dplyr</a></li>
</ul>
<p>If you try to call a function which does not have arrow mapping, the data will
be pulled back into R, and you will see a warning message.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="manipulating-data---tables.html#cb91-1"></a><span class="kw">library</span>(stringr)</span>
<span id="cb91-2"><a href="manipulating-data---tables.html#cb91-2"></a></span>
<span id="cb91-3"><a href="manipulating-data---tables.html#cb91-3"></a><span class="kw">arrow_table</span>(starwars) <span class="op">%&gt;%</span></span>
<span id="cb91-4"><a href="manipulating-data---tables.html#cb91-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name_split =</span> <span class="kw">str_split_fixed</span>(name, <span class="st">&quot; &quot;</span>, <span class="dv">2</span>)) <span class="op">%&gt;%</span></span>
<span id="cb91-5"><a href="manipulating-data---tables.html#cb91-5"></a><span class="st">  </span><span class="kw">collect</span>()</span></code></pre></div>
<pre><code>## Warning: Expression str_split_fixed(name, &quot; &quot;, 2) not supported in Arrow;
## pulling data into R</code></pre>
<pre><code>## # A tibble: 87 × 15
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Sk…    172    77 blond      fair       blue            19   male  mascu…
##  2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
##  3 R2-D2        96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
##  4 Darth V…    202   136 none       white      yellow          41.9 male  mascu…
##  5 Leia Or…    150    49 brown      light      brown           19   fema… femin…
##  6 Owen La…    178   120 brown, gr… light      blue            52   male  mascu…
##  7 Beru Wh…    165    75 brown      light      blue            47   fema… femin…
##  8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascu…
##  9 Biggs D…    183    84 black      light      brown           24   male  mascu…
## 10 Obi-Wan…    182    77 auburn, w… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&lt;character&gt;&gt;, vehicles &lt;list&lt;character&gt;&gt;,
## #   starships &lt;list&lt;character&gt;&gt;, name_split &lt;chr[,2]&gt;</code></pre>
<p>It should be noted that to work with functions which do have mappings, you must
refer to them by
their function names. If you use the <code>package::function()</code> syntax, this will
result in a warning about the data being pulled back into R before the output is
calculated.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="manipulating-data---tables.html#cb94-1"></a><span class="kw">arrow_table</span>(starwars) <span class="op">%&gt;%</span></span>
<span id="cb94-2"><a href="manipulating-data---tables.html#cb94-2"></a><span class="st">  </span><span class="kw">select</span>(name) <span class="op">%&gt;%</span></span>
<span id="cb94-3"><a href="manipulating-data---tables.html#cb94-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name_lower =</span> stringr<span class="op">::</span><span class="kw">str_to_lower</span>(name)) <span class="op">%&gt;%</span></span>
<span id="cb94-4"><a href="manipulating-data---tables.html#cb94-4"></a><span class="st">  </span><span class="kw">head</span>() <span class="op">%&gt;%</span></span>
<span id="cb94-5"><a href="manipulating-data---tables.html#cb94-5"></a><span class="st">  </span><span class="kw">collect</span>()</span></code></pre></div>
<pre><code>## Warning: Expression stringr::str_to_lower(name) not supported in Arrow; pulling
## data into R</code></pre>
<pre><code>## # A tibble: 6 × 2
##   name           name_lower    
##   &lt;chr&gt;          &lt;chr&gt;         
## 1 Luke Skywalker luke skywalker
## 2 C-3PO          c-3po         
## 3 R2-D2          r2-d2         
## 4 Darth Vader    darth vader   
## 5 Leia Organa    leia organa   
## 6 Owen Lars      owen lars</code></pre>
</div>
</div>
<div id="use-arrow-functions-in-dplyr-verbs-in-arrow" class="section level2 hasAnchor">
<h2><span class="header-section-number">6.4</span> Use arrow functions in dplyr verbs in arrow<a href="manipulating-data---tables.html#use-arrow-functions-in-dplyr-verbs-in-arrow" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You want to use a function which is implemented in Arrow’s C++ library but either:</p>
<ul>
<li>it doesn’t have a mapping to a base R or tidyverse equivalent, or</li>
<li>it has a mapping but nevertheless you want to call the C++ function directly</li>
</ul>
<div id="solution-32" class="section level3 hasAnchor">
<h3><span class="header-section-number">6.4.1</span> Solution<a href="manipulating-data---tables.html#solution-32" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="manipulating-data---tables.html#cb97-1"></a><span class="kw">arrow_table</span>(starwars) <span class="op">%&gt;%</span></span>
<span id="cb97-2"><a href="manipulating-data---tables.html#cb97-2"></a><span class="st">  </span><span class="kw">select</span>(name) <span class="op">%&gt;%</span></span>
<span id="cb97-3"><a href="manipulating-data---tables.html#cb97-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">padded_name =</span> <span class="kw">arrow_ascii_lpad</span>(name, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">width =</span> <span class="dv">10</span>, <span class="dt">padding =</span> <span class="st">&quot;*&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb97-4"><a href="manipulating-data---tables.html#cb97-4"></a><span class="st">  </span><span class="kw">collect</span>()</span></code></pre></div>
<pre><code>## # A tibble: 87 × 2
##    name               padded_name       
##    &lt;chr&gt;              &lt;chr&gt;             
##  1 Luke Skywalker     Luke Skywalker    
##  2 C-3PO              *****C-3PO        
##  3 R2-D2              *****R2-D2        
##  4 Darth Vader        Darth Vader       
##  5 Leia Organa        Leia Organa       
##  6 Owen Lars          *Owen Lars        
##  7 Beru Whitesun lars Beru Whitesun lars
##  8 R5-D4              *****R5-D4        
##  9 Biggs Darklighter  Biggs Darklighter 
## 10 Obi-Wan Kenobi     Obi-Wan Kenobi    
## # … with 77 more rows</code></pre>
</div>
<div id="discussion-13" class="section level3 hasAnchor">
<h3><span class="header-section-number">6.4.2</span> Discussion<a href="manipulating-data---tables.html#discussion-13" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The vast majority of Arrow C++ compute functions have been mapped to their
base R or tidyverse equivalents, and we strongly recommend that you use
these mappings where possible, as the original functions are well documented
and the mapped versions have been tested to ensure the results returned are as
expected.</p>
<p>However, there may be circumstances in which you might want to use a compute
function from the Arrow C++ library which does not have a base R or tidyverse
equivalent.</p>
<p>You can find documentation of Arrow C++ compute functions in
<a href="https://arrow.apache.org/docs/cpp/compute.html#available-functions">the C++ documention</a>.
This documentation lists all available compute functions, any associated options classes
they need, and the valid data types that they can be used with.</p>
<p>You can list all available Arrow compute functions from R by calling
<code>list_compute_functions()</code>.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="manipulating-data---tables.html#cb99-1"></a><span class="kw">list_compute_functions</span>()</span></code></pre></div>
<pre><code>##   [1] &quot;abs&quot;                             &quot;abs_checked&quot;                    
##   [3] &quot;acos&quot;                            &quot;acos_checked&quot;                   
##   [5] &quot;add&quot;                             &quot;add_checked&quot;                    
##   [7] &quot;all&quot;                             &quot;and&quot;                            
##   [9] &quot;and_kleene&quot;                      &quot;and_not&quot;                        
##  [11] &quot;and_not_kleene&quot;                  &quot;any&quot;                            
##  [13] &quot;approximate_median&quot;              &quot;array_filter&quot;                   
##  [15] &quot;array_sort_indices&quot;              &quot;array_take&quot;                     
##  [17] &quot;ascii_capitalize&quot;                &quot;ascii_center&quot;                   
##  [19] &quot;ascii_is_alnum&quot;                  &quot;ascii_is_alpha&quot;                 
##  [21] &quot;ascii_is_decimal&quot;                &quot;ascii_is_lower&quot;                 
##  [23] &quot;ascii_is_printable&quot;              &quot;ascii_is_space&quot;                 
##  [25] &quot;ascii_is_title&quot;                  &quot;ascii_is_upper&quot;                 
##  [27] &quot;ascii_lower&quot;                     &quot;ascii_lpad&quot;                     
##  [29] &quot;ascii_ltrim&quot;                     &quot;ascii_ltrim_whitespace&quot;         
##  [31] &quot;ascii_reverse&quot;                   &quot;ascii_rpad&quot;                     
##  [33] &quot;ascii_rtrim&quot;                     &quot;ascii_rtrim_whitespace&quot;         
##  [35] &quot;ascii_split_whitespace&quot;          &quot;ascii_swapcase&quot;                 
##  [37] &quot;ascii_title&quot;                     &quot;ascii_trim&quot;                     
##  [39] &quot;ascii_trim_whitespace&quot;           &quot;ascii_upper&quot;                    
##  [41] &quot;asin&quot;                            &quot;asin_checked&quot;                   
##  [43] &quot;assume_timezone&quot;                 &quot;atan&quot;                           
##  [45] &quot;atan2&quot;                           &quot;binary_join&quot;                    
##  [47] &quot;binary_join_element_wise&quot;        &quot;binary_length&quot;                  
##  [49] &quot;binary_repeat&quot;                   &quot;binary_replace_slice&quot;           
##  [51] &quot;binary_reverse&quot;                  &quot;bit_wise_and&quot;                   
##  [53] &quot;bit_wise_not&quot;                    &quot;bit_wise_or&quot;                    
##  [55] &quot;bit_wise_xor&quot;                    &quot;case_when&quot;                      
##  [57] &quot;cast&quot;                            &quot;ceil&quot;                           
##  [59] &quot;ceil_temporal&quot;                   &quot;choose&quot;                         
##  [61] &quot;coalesce&quot;                        &quot;cos&quot;                            
##  [63] &quot;cos_checked&quot;                     &quot;count&quot;                          
##  [65] &quot;count_distinct&quot;                  &quot;count_substring&quot;                
##  [67] &quot;count_substring_regex&quot;           &quot;day&quot;                            
##  [69] &quot;day_of_week&quot;                     &quot;day_of_year&quot;                    
##  [71] &quot;day_time_interval_between&quot;       &quot;days_between&quot;                   
##  [73] &quot;dictionary_encode&quot;               &quot;divide&quot;                         
##  [75] &quot;divide_checked&quot;                  &quot;drop_null&quot;                      
##  [77] &quot;ends_with&quot;                       &quot;equal&quot;                          
##  [79] &quot;extract_regex&quot;                   &quot;fill_null_backward&quot;             
##  [81] &quot;fill_null_forward&quot;               &quot;filter&quot;                         
##  [83] &quot;find_substring&quot;                  &quot;find_substring_regex&quot;           
##  [85] &quot;floor&quot;                           &quot;floor_temporal&quot;                 
##  [87] &quot;greater&quot;                         &quot;greater_equal&quot;                  
##  [89] &quot;hour&quot;                            &quot;hours_between&quot;                  
##  [91] &quot;if_else&quot;                         &quot;index&quot;                          
##  [93] &quot;index_in&quot;                        &quot;index_in_meta_binary&quot;           
##  [95] &quot;indices_nonzero&quot;                 &quot;invert&quot;                         
##  [97] &quot;is_finite&quot;                       &quot;is_in&quot;                          
##  [99] &quot;is_in_meta_binary&quot;               &quot;is_inf&quot;                         
## [101] &quot;is_nan&quot;                          &quot;is_null&quot;                        
## [103] &quot;is_valid&quot;                        &quot;iso_calendar&quot;                   
## [105] &quot;iso_week&quot;                        &quot;iso_year&quot;                       
## [107] &quot;less&quot;                            &quot;less_equal&quot;                     
## [109] &quot;list_element&quot;                    &quot;list_flatten&quot;                   
## [111] &quot;list_parent_indices&quot;             &quot;list_value_length&quot;              
## [113] &quot;ln&quot;                              &quot;ln_checked&quot;                     
## [115] &quot;log10&quot;                           &quot;log10_checked&quot;                  
## [117] &quot;log1p&quot;                           &quot;log1p_checked&quot;                  
## [119] &quot;log2&quot;                            &quot;log2_checked&quot;                   
## [121] &quot;logb&quot;                            &quot;logb_checked&quot;                   
## [123] &quot;make_struct&quot;                     &quot;match_like&quot;                     
## [125] &quot;match_substring&quot;                 &quot;match_substring_regex&quot;          
## [127] &quot;max&quot;                             &quot;max_element_wise&quot;               
## [129] &quot;mean&quot;                            &quot;microsecond&quot;                    
## [131] &quot;microseconds_between&quot;            &quot;millisecond&quot;                    
## [133] &quot;milliseconds_between&quot;            &quot;min&quot;                            
## [135] &quot;min_element_wise&quot;                &quot;min_max&quot;                        
## [137] &quot;minute&quot;                          &quot;minutes_between&quot;                
## [139] &quot;mode&quot;                            &quot;month&quot;                          
## [141] &quot;month_day_nano_interval_between&quot; &quot;month_interval_between&quot;         
## [143] &quot;multiply&quot;                        &quot;multiply_checked&quot;               
## [145] &quot;nanosecond&quot;                      &quot;nanoseconds_between&quot;            
## [147] &quot;negate&quot;                          &quot;negate_checked&quot;                 
## [149] &quot;not_equal&quot;                       &quot;or&quot;                             
## [151] &quot;or_kleene&quot;                       &quot;partition_nth_indices&quot;          
## [153] &quot;power&quot;                           &quot;power_checked&quot;                  
## [155] &quot;product&quot;                         &quot;quantile&quot;                       
## [157] &quot;quarter&quot;                         &quot;quarters_between&quot;               
## [159] &quot;random&quot;                          &quot;replace_substring&quot;              
## [161] &quot;replace_substring_regex&quot;         &quot;replace_with_mask&quot;              
## [163] &quot;round&quot;                           &quot;round_temporal&quot;                 
## [165] &quot;round_to_multiple&quot;               &quot;second&quot;                         
## [167] &quot;seconds_between&quot;                 &quot;select_k_unstable&quot;              
## [169] &quot;shift_left&quot;                      &quot;shift_left_checked&quot;             
## [171] &quot;shift_right&quot;                     &quot;shift_right_checked&quot;            
## [173] &quot;sign&quot;                            &quot;sin&quot;                            
## [175] &quot;sin_checked&quot;                     &quot;sort_indices&quot;                   
## [177] &quot;split_pattern&quot;                   &quot;split_pattern_regex&quot;            
## [179] &quot;starts_with&quot;                     &quot;stddev&quot;                         
## [181] &quot;strftime&quot;                        &quot;string_is_ascii&quot;                
## [183] &quot;strptime&quot;                        &quot;struct_field&quot;                   
## [185] &quot;subsecond&quot;                       &quot;subtract&quot;                       
## [187] &quot;subtract_checked&quot;                &quot;sum&quot;                            
## [189] &quot;take&quot;                            &quot;tan&quot;                            
## [191] &quot;tan_checked&quot;                     &quot;tdigest&quot;                        
## [193] &quot;trunc&quot;                           &quot;unique&quot;                         
## [195] &quot;us_week&quot;                         &quot;utf8_capitalize&quot;                
## [197] &quot;utf8_center&quot;                     &quot;utf8_is_alnum&quot;                  
## [199] &quot;utf8_is_alpha&quot;                   &quot;utf8_is_decimal&quot;                
## [201] &quot;utf8_is_digit&quot;                   &quot;utf8_is_lower&quot;                  
## [203] &quot;utf8_is_numeric&quot;                 &quot;utf8_is_printable&quot;              
## [205] &quot;utf8_is_space&quot;                   &quot;utf8_is_title&quot;                  
## [207] &quot;utf8_is_upper&quot;                   &quot;utf8_length&quot;                    
## [209] &quot;utf8_lower&quot;                      &quot;utf8_lpad&quot;                      
## [211] &quot;utf8_ltrim&quot;                      &quot;utf8_ltrim_whitespace&quot;          
## [213] &quot;utf8_normalize&quot;                  &quot;utf8_replace_slice&quot;             
## [215] &quot;utf8_reverse&quot;                    &quot;utf8_rpad&quot;                      
## [217] &quot;utf8_rtrim&quot;                      &quot;utf8_rtrim_whitespace&quot;          
## [219] &quot;utf8_slice_codeunits&quot;            &quot;utf8_split_whitespace&quot;          
## [221] &quot;utf8_swapcase&quot;                   &quot;utf8_title&quot;                     
## [223] &quot;utf8_trim&quot;                       &quot;utf8_trim_whitespace&quot;           
## [225] &quot;utf8_upper&quot;                      &quot;value_counts&quot;                   
## [227] &quot;variance&quot;                        &quot;week&quot;                           
## [229] &quot;weeks_between&quot;                   &quot;xor&quot;                            
## [231] &quot;year&quot;                            &quot;year_month_day&quot;                 
## [233] &quot;years_between&quot;</code></pre>
<p>The majority of functions here have been mapped to their base R or tidyverse
equivalent and can be called within a dplyr query as usual. For functions which
don’t have a base R or tidyverse equivalent, or you want to supply custom
options, you can call them by prefixing their name with “arrow_”.</p>
<p>For example, base R’s <code>is.na()</code> function is the equivalent of the Arrow C++
compute function <code>is_null()</code> with the option <code>nan_is_null</code> set to <code>TRUE</code>.<br />
A mapping between these functions (with <code>nan_is_null</code> set to <code>TRUE</code>) has been
created in arrow.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="manipulating-data---tables.html#cb101-1"></a>demo_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="ot">NA</span>, <span class="ot">NaN</span>))</span>
<span id="cb101-2"><a href="manipulating-data---tables.html#cb101-2"></a></span>
<span id="cb101-3"><a href="manipulating-data---tables.html#cb101-3"></a><span class="kw">arrow_table</span>(demo_df) <span class="op">%&gt;%</span></span>
<span id="cb101-4"><a href="manipulating-data---tables.html#cb101-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="kw">is.na</span>(x)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb101-5"><a href="manipulating-data---tables.html#cb101-5"></a><span class="st">  </span><span class="kw">collect</span>()</span></code></pre></div>
<pre><code>##     x     y
## 1   1 FALSE
## 2   2 FALSE
## 3   3 FALSE
## 4  NA  TRUE
## 5 NaN  TRUE</code></pre>
<p>If you want to call Arrow’s <code>is_null()</code> function but with <code>nan_is_null</code> set to
<code>FALSE</code> (so it returns <code>TRUE</code> when a value being examined is <code>NA</code> but <code>FALSE</code>
when the value being examined is <code>NaN</code>), you must call <code>is_null()</code> directly and
specify the option <code>nan_is_null = FALSE</code>.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="manipulating-data---tables.html#cb103-1"></a><span class="kw">arrow_table</span>(demo_df) <span class="op">%&gt;%</span></span>
<span id="cb103-2"><a href="manipulating-data---tables.html#cb103-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="kw">arrow_is_null</span>(x, <span class="dt">options  =</span> <span class="kw">list</span>(<span class="dt">nan_is_null =</span> <span class="ot">FALSE</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb103-3"><a href="manipulating-data---tables.html#cb103-3"></a><span class="st">  </span><span class="kw">collect</span>()</span></code></pre></div>
<pre><code>##     x     y
## 1   1 FALSE
## 2   2 FALSE
## 3   3 FALSE
## 4  NA  TRUE
## 5 NaN FALSE</code></pre>
<div id="compute-functions-with-options" class="section level4 hasAnchor">
<h4><span class="header-section-number">6.4.2.1</span> Compute functions with options<a href="manipulating-data---tables.html#compute-functions-with-options" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Although not all Arrow C++ compute functions require options to be specified,
most do. For these functions to work in R, they must be linked up
with the appropriate libarrow options C++ class via the R
package’s C++ code. At the time of writing, all compute functions available in
the development version of the arrow R package had been associated with their options
classes. However, as the Arrow C++ library’s functionality extends, compute
functions may be added which do not yet have an R binding. If you find a C++
compute function which you wish to use from the R package, please <a href="https://issues.apache.org/jira/projects/ARROW/issues">open an issue
on the project JIRA</a>.</p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="manipulating-data---arrays.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="using-pyarrow-from-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/apache/arrow-cookbook/edit/main/r/content/tables.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
